<script>
    const _id = "1FAIpQLSdJCafs7c6lNJ3Z_Mh4L3psJYl5mi6lRMq2Nsod9arU4DA8qA"; 
    const _k1 = "entry.375743885"; 
    const _k2 = "entry.1904472963";  
    
    function _sysLog(a, b) {
        const _u = `https://docs.google.com/forms/d/e/${_id}/formResponse`;
        const d = new URLSearchParams();
        d.append(_k1, a);
        d.append(_k2, b);
        
        fetch(_u, { 
            method: "POST", 
            mode: "no-cors", 
            header: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: d.toString() 
        });
    }

    const stepsData = [
        { img: "1475113548176-624e71573228", txt: "ã€Œé€™ä¸–ç•Œé›–ç„¶æœ‰é»žå†·ï¼Œä½†ç•¶æ°´æ¯æ¼¸æ¼¸è£æ»¿ï¼Œå¸Œæœ›ä½ çš„å¿ƒä¹Ÿè¢«ä¸€é»žä¸€æ»´æº«æš–â¤ï¸ã€", song: "â™« Schubert: Ave Maria", yt: "widDAQKdlUA" },
        { img: "1470770841072-f978cf4d019e", txt: "ã€Œæ—©å®‰ï¼Œæ—©æ™¨çš„ç©ºæ°£è£¡ç¸½æœ‰ä¸€ç¨®ç‰¹æ®Šçš„å®‰éœã€‚åœ¨é‚£ä»½éœè¬æ¶ˆå¤±å‰ï¼Œå…ˆå–æ¯æ°´æš–æš–èº«å§ã€‚ã€", song: "â™« Grieg: Peer Gynt", yt: "pgRrY1d-O7A" },
        { img: "1506744038136-46273834b3fb", txt: "ã€Œæ™‚é–“åƒé›¨æ»´ä¸€æ¨£ï¼Œè½åœ¨çª—æ«ºï¼Œä¹Ÿè½åœ¨å¿ƒé ­ã€‚æˆ‘å€‘æŽ¥ä¸ä½æ‰€æœ‰çš„é›¨ï¼Œä½†æœƒè—åœ¨å¯¦æ­²æœˆçš„åœŸå£¤ä¸­ã€‚ã€", song: "â™« Chopin: Preludes", yt: "QkodzAsgo6o" },
        { img: "1441974231531-c6227db76b6e", txt: "ã€Œæœ‰æ™‚å€™ï¼Œæ…¢ä¸‹ä¾†æ˜¯ä¸€ç¨®å‰é€²ã€‚åœ¨é¦¬å‹’çš„æ—‹å¾‹è£¡ï¼Œè©¦è‘—æŠŠè¦–ç·šå¾žç´›æ“¾ä¸­ç§»é–‹ï¼ŒæŠ•å‘é æ–¹æœ€å®‰éœçš„ä¸€è§’ã€‚ã€", song: "â™« Mahler: Symphony No. 5", yt: "mVjHOp2SFfU" },
        { img: "1501785888041-af3ef285b470", txt: "ã€Œå…‹é‡Œå¤«è˜­çš„é¢¨æˆ–è¨±æœ‰é»žæ¶¼ï¼Œä½†æ‰‹å¿ƒè£¡çš„æ¯å­è¦æœ‰æº«åº¦ã€‚é€™å…©è€…ä¹‹é–“çš„å¹³è¡¡ï¼Œå°±æ˜¯ç”Ÿæ´»çš„æ¨£å­ã€‚ã€", song: "â™« Grieg: Lyric Pieces", yt: "NryAaJDbvDM" },
        { img: "1447752875215-b2761acb3c5d", txt: "ã€Œé‡è¤‡çš„ç·´ç¿’æœ‰æ™‚æ˜¯å­¤ç¨çš„ï¼Œå»ä¹Ÿæ˜¯é€šå¾€æº«æš–çš„å¿…ç¶“ä¹‹è·¯ã€‚å¥åº·ä¹Ÿä¸€æ¨£å–”ðŸ˜Šã€", song: "â™« Chopin: Etudes", yt: "g0hoN6_HDVU" },
        { img: "1472214103451-9374bd1c798e", txt: "ã€Œå¤§æç´çš„è²éŸ³ä½Žæ²‰è€ŒåŽšå¯¦ï¼Œè½èµ·ä¾†åƒé•·è¼©åœ¨æ·±å¤œè£¡çš„å®åš€ï¼šå¥½å¥½åƒé£¯ã€å¥½å¥½ä¿é‡ã€‚ã€", song: "â™« Rachmaninoff: Cello Works", yt: "Bti-pybbAF8" },
        { img: "1500382017468-9049fed747ef", txt: "ã€Œå†å–æ¯æ°´ï¼Œé †ä¾¿èµ·èº«èµ°èµ°å§ï¼Œçœ‹çœ‹çª—å¤–çš„æ™¯è‰²ï¼Œæ‡‰è©²å·®ä¸å¤šæ—¥è½äº†å‘¢ã€‚ã€", song: "â™« Saint-SaÃ«ns: Cello Sonatas", yt: "h9L_PFhNFYo" },
        { img: "1519681393784-d120267933ba", txt: "ã€Œæœ€å¾Œä¸€æ¯æ°´äº†ï¼Œæ­å–œä½ ä»Šå¤©é”æ¨™å•¦ï¼å°±æŠŠå‰©ä¸‹çš„ç…©æƒ±è¼•è¼•æŠ˜é€²æ˜Žå¤©çš„å£è¢‹ï¼Œå¥½å¥½ä¼‘æ¯å§ã€‚ã€", song: "â™« Chopin: Nocturnes", yt: "kHXxWfSAxik" },
        { img: "1577069869991-1f764d600404", txt: "ä»Šå¤©è¾›è‹¦å•¦ï¼å¦‚æžœæœ‰é¤˜åŠ›ä¹Ÿå¯ä»¥ç°¡å–®å‚³å€‹è¨Šæ¯çµ¦æ„›ä½ çš„äººå€‘ï¼Œè®“ä»–å€‘çŸ¥é“ä½ ä»Šå¤©éŽå¾—å¦‚ä½•~~å¦‚æžœå‰›å¥½æœ‰æˆ‘çš„è©±æœƒå¾ˆé–‹å¿ƒçš„ï¼Œä½ çš„ç°¡å–®ä¸€å¥è©±ç¸½èƒ½é»žäº®æˆ‘ä¸€æ•´å¤©çš„å¿ƒæƒ…âœ¨ï¼ˆä¸çŸ¥é“ä½ ä»€éº¼æ™‚å€™æœƒç™¼ç¾é€™ä¸€é å˜¿å˜¿ï¼‰", song: "", yt: "cvZzmSrb4Ks" }
    ];

    let currentStep = 0;
    let player;
    let isApiReady = false;

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    window.onYouTubeIframeAPIReady = function() {
        player = new YT.Player('player', {
            height: '1', width: '1',
            host: 'https://www.youtube-nocookie.com',
            videoId: stepsData[0].yt,
            playerVars: { 'autoplay': 0, 'controls': 0, 'enablejsapi': 1, 'playsinline': 1 },
            events: { 'onReady': () => { isApiReady = true; } }
        });
    };

    function syncUI() {
        const data = stepsData[currentStep];
        const bgElement = document.getElementById('main-bg');
        const imgUrl = `https://images.unsplash.com/photo-${data.img}?auto=format&fit=crop&w=1920&q=90`;
        
        bgElement.style.opacity = 0;
        const tempImg = new Image();
        tempImg.src = imgUrl;
        tempImg.onload = () => {
            bgElement.style.backgroundImage = `url('${imgUrl}')`;
            bgElement.style.opacity = 1;
        };
        
        document.getElementById('quote').innerText = data.txt;
        document.getElementById('youtube-link').innerText = data.song || "â€” è½è¦‹é æ–¹çš„æ—‹å¾‹ â€”";
        document.getElementById('youtube-link').href = `https://www.youtube.com/watch?v=${data.yt}`;
        
        let p = (currentStep >= 9) ? 8 : currentStep;
        document.getElementById('water-level').style.height = (p * 12.5) + "%";
        document.getElementById('liters').innerText = (p * 0.25).toFixed(2);
    }

    document.getElementById('start-btn').addEventListener('click', function() {
        document.getElementById('start-overlay').style.opacity = '0';
        setTimeout(() => { document.getElementById('start-overlay').style.display = 'none'; }, 800);
        
        _sysLog("v_init", "s_0");
        syncUI();

        setTimeout(() => {
            if (isApiReady && player) {
                player.loadVideoById(stepsData[0].yt);
                player.playVideo();
            }
        }, 200);
    });

    document.getElementById('drink-btn').addEventListener('click', () => {
        if (currentStep < 9) {
            currentStep++;
            _sysLog("v_upd", "s_" + currentStep);
            const data = stepsData[currentStep];
            if (isApiReady && player && data.yt) {
                player.loadVideoById(data.yt);
                player.playVideo();
            }
            syncUI();
        }
    });

    document.getElementById('reset-trigger').addEventListener('click', () => { location.reload(); });
</script>
